/**
 * @author sl 2019-01-02
 * 底图
 */

import mapboxgl from 'mapbox-gl';
import React, { Component } from 'react';

import MapStyles from './map-styles';
import ZjjdLayer from './jiudian';

export default class MapBoxDemo extends Component {
  componentDidMount = () => this._init();

  componentWillUnmount = () => this.map.remove();

  render() {
    return (
      <div
        style={{ width: '100%', height: '100%' }}
        ref={_el => (this._mapContainer = _el)}
      />
    );
  }

  _init = () => {
    window._MAP_ = this.map = new mapboxgl.Map({
      hash: true,
      container: this._mapContainer,
      style: MapStyles,
      showTileBoundaries: true,
      center: [120.208615, 30.245062],
      zoom: 17,
      pitch: 60,
      // bearing: -13.6,
      minZoom: 8,
      maxZoom: 20,
      localIdeographFontFamily: '黑体'
    });
    this.map.on('style.load', () => {
      // 30.2449/120.209
      this.map.addLayer(ZjjdLayer, '15_HOUSE');
      this.map.addLayer(
        {
          id: 'testtest1', //15级房屋
          source: {
            type: 'geojson',
            data: {
              type: 'Feature',
              geometry: {
                type: 'Polygon',
                coordinates: [
                  [
                    [120.165462, 30.244499],
                    [120.165462, 30.244491],
                    [120.165433, 30.244491],
                    [120.165394, 30.244491],
                    [120.165394, 30.244483],
                    [120.165245, 30.244481],
                    [120.165242, 30.244481],
                    [120.165242, 30.244485],
                    [120.164792, 30.244461],
                    [120.164791, 30.244485],
                    [120.165241, 30.244509],
                    [120.165241, 30.244515],
                    [120.164898, 30.244514],
                    [120.164897, 30.244643],
                    [120.164998, 30.244643],
                    [120.165141, 30.244644],
                    [120.165239, 30.244644],
                    [120.165245, 30.244644],
                    [120.165245, 30.244643],
                    [120.165249, 30.244643],
                    [120.165461, 30.244646],
                    [120.165461, 30.244651],
                    [120.165355, 30.24465],
                    [120.165354, 30.244806],
                    [120.165285, 30.244805],
                    [120.165246, 30.244805],
                    [120.165243, 30.244805],
                    [120.165093, 30.244805],
                    [120.165044, 30.244804],
                    [120.164897, 30.244804],
                    [120.164897, 30.244806],
                    [120.164895, 30.244932],
                    [120.165242, 30.244934],
                    [120.165248, 30.244934],
                    [120.16537, 30.244934],
                    [120.165371, 30.244934],
                    [120.16538, 30.244934],
                    [120.16538, 30.244978],
                    [120.165414, 30.244978],
                    [120.165461, 30.244978],
                    [120.165492, 30.244978],
                    [120.165492, 30.244935],
                    [120.165519, 30.244936],
                    [120.165521, 30.244803],
                    [120.165523, 30.24472],
                    [120.165552, 30.244721],
                    [120.165616, 30.244721],
                    [120.165616, 30.244738],
                    [120.165643, 30.244737],
                    [120.165643, 30.244724],
                    [120.165705, 30.244724],
                    [120.165705, 30.244719],
                    [120.165705, 30.244702],
                    [120.165699, 30.244557],
                    [120.165679, 30.244557],
                    [120.165679, 30.244551],
                    [120.16568, 30.244535],
                    [120.165677, 30.244535],
                    [120.165576, 30.244529],
                    [120.165552, 30.244528],
                    [120.165535, 30.244526],
                    [120.165538, 30.244491],
                    [120.165521, 30.24449],
                    [120.16552, 30.244501],
                    [120.165462, 30.244499]
                  ],
                  [
                    [120.165479, 30.244601],
                    [120.165461, 30.244601],
                    [120.165462, 30.244569],
                    [120.165478, 30.244568],
                    [120.165479, 30.244601]
                  ],
                  [
                    [120.165461, 30.244524],
                    [120.165245, 30.244523],
                    [120.165245, 30.244522],
                    [120.165245, 30.244517],
                    [120.165461, 30.244518],
                    [120.165461, 30.244524]
                  ]
                ]
              }
            }
          },
          type: 'fill-extrusion',
          paint: {
            'fill-extrusion-color': 'rgb(0, 255, 0)',
            'fill-extrusion-height': [
              'interpolate',
              ['linear'],
              ['zoom'],
              16,
              0,
              16 + 0.55,
              12
            ],
            'fill-extrusion-base': 10.5,
            'fill-extrusion-opacity': 1
          }
        },
        '15_HOUSE'
      );
      this.map.on('click', '15_HOUSE', e => {
        console.log(e, e.features[0]);
      });
      this.map.on('click', '15_BUILDING', e => {
        console.log(e, e.features[0]);
      });
    });
  };
}
