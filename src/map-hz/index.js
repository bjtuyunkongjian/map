/**
 * @author sl 2019-01-02
 * 底图
 */

import mapboxgl from 'mapbox-gl';
import React, { Component } from 'react';

import MapStyles from './map-styles';
import ZjjdLayer from './jiudian';

export default class MapBoxDemo extends Component {
  componentDidMount = () => this._init();

  componentWillUnmount = () => this.map.remove();

  render() {
    return (
      <div
        style={{ width: '100%', height: '100%' }}
        ref={_el => (this._mapContainer = _el)}
      />
    );
  }

  _init = () => {
    window._MAP_ = this.map = new mapboxgl.Map({
      hash: true,
      container: this._mapContainer,
      style: MapStyles,
      showTileBoundaries: true,
      center: [120.208615, 30.245062],
      zoom: 17,
      pitch: 60,
      // bearing: -13.6,
      minZoom: 8,
      maxZoom: 20,
      localIdeographFontFamily: '黑体'
    });
    this.map.on('style.load', () => {
      // 30.2449/120.209
      this.map.addLayer(ZjjdLayer, '15_HOUSE');
      this.map.addLayer(
        {
          id: 'testtest', //15级房屋
          source: {
            type: 'geojson',
            data: {
              type: 'Feature',
              geometry: {
                type: 'Polygon',
                coordinates: [
                  [
                    [120.2008747, 30.2432983],
                    [120.200987, 30.2434373],
                    [120.2010872, 30.2435613],
                    [120.2010872, 30.2435613],
                    [120.2010872, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2011919, 30.2434982],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.2013434, 30.2434769],
                    [120.2013434, 30.2434769],
                    [120.201364, 30.2434611],
                    [120.201364, 30.2434611],
                    [120.2013813, 30.2434426],
                    [120.2013813, 30.2434426],
                    [120.2013848, 30.2434371],
                    [120.2013948, 30.2434218],
                    [120.2013948, 30.2434218],
                    [120.2014041, 30.2433994],
                    [120.2014041, 30.2433994],
                    [120.201409, 30.2433759],
                    [120.201409, 30.2433759],
                    [120.2014093, 30.2433521],
                    [120.2014093, 30.2433521],
                    [120.2014051, 30.2433285],
                    [120.2014051, 30.2433285],
                    [120.2013963, 30.2433059],
                    [120.2013963, 30.2433059],
                    [120.2013833, 30.2432848],
                    [120.2013833, 30.2432848],
                    [120.2013665, 30.243266],
                    [120.2013665, 30.243266],
                    [120.2013463, 30.2432498],
                    [120.2013463, 30.2432498],
                    [120.2013158, 30.2432337],
                    [120.2013242, 30.2432217],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013242, 30.2432216],
                    [120.2013242, 30.2432215],
                    [120.2013242, 30.2432215],
                    [120.2013242, 30.2432215],
                    [120.2012999, 30.2432101],
                    [120.2012361, 30.2431752],
                    [120.2011765, 30.243135],
                    [120.2011219, 30.2430899],
                    [120.2010727, 30.2430402],
                    [120.2010294, 30.2429866],
                    [120.2009925, 30.2429294],
                    [120.2009624, 30.2428694],
                    [120.200949, 30.2428187],
                    [120.2009428, 30.242767],
                    [120.2009438, 30.242715],
                    [120.2009521, 30.2426635],
                    [120.2009675, 30.2426133],
                    [120.2009897, 30.242565],
                    [120.2010186, 30.2425194],
                    [120.2010535, 30.2424772],
                    [120.201109, 30.2424257],
                    [120.2011689, 30.242378],
                    [120.2012328, 30.2423345],
                    [120.2013004, 30.2422953],
                    [120.2013712, 30.2422608],
                    [120.2014448, 30.242231],
                    [120.2015063, 30.2422108],
                    [120.2016513, 30.2421629],
                    [120.2016514, 30.2421629],
                    [120.2016514, 30.2421629],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421627],
                    [120.2016377, 30.2421319],
                    [120.2016633, 30.2421233],
                    [120.2016634, 30.2421233],
                    [120.2016871, 30.2421111],
                    [120.2016871, 30.2421111],
                    [120.2017082, 30.2420957],
                    [120.2017083, 30.2420957],
                    [120.2017262, 30.2420774],
                    [120.2017262, 30.2420774],
                    [120.2017403, 30.2420568],
                    [120.2017403, 30.2420568],
                    [120.2017504, 30.2420345],
                    [120.2017504, 30.2420345],
                    [120.2017561, 30.242011],
                    [120.2017561, 30.242011],
                    [120.2017572, 30.2419871],
                    [120.2017572, 30.2419871],
                    [120.2017538, 30.2419633],
                    [120.2017538, 30.2419633],
                    [120.2017458, 30.2419403],
                    [120.2017458, 30.2419403],
                    [120.2017337, 30.2419188],
                    [120.2017337, 30.2419188],
                    [120.2017249, 30.2419074],
                    [120.2017249, 30.2419073],
                    [120.201715, 30.2418967],
                    [120.201715, 30.2418967],
                    [120.2016187, 30.2418108],
                    [120.2016187, 30.2418108],
                    [120.2016187, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2015715, 30.2418506],
                    [120.2015609, 30.2418412],
                    [120.2014822, 30.241771],
                    [120.2014822, 30.241771],
                    [120.2014822, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2012147, 30.2419964],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010612, 30.2421665],
                    [120.2010766, 30.2421819],
                    [120.2010945, 30.2421998],
                    [120.2010801, 30.2422107],
                    [120.2010715, 30.2422172],
                    [120.2010209, 30.2422554],
                    [120.2009965, 30.2422738],
                    [120.200969, 30.2422945],
                    [120.2009415, 30.2423152],
                    [120.2008952, 30.2422693],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008084, 30.2423431],
                    [120.2007582, 30.2423838],
                    [120.2007582, 30.2423839],
                    [120.2007133, 30.242429],
                    [120.2007133, 30.2424291],
                    [120.2006745, 30.2424782],
                    [120.2006745, 30.2424782],
                    [120.200642, 30.2425308],
                    [120.200642, 30.2425308],
                    [120.2006163, 30.2425861],
                    [120.2006162, 30.2425861],
                    [120.2005976, 30.2426436],
                    [120.2005976, 30.2426436],
                    [120.2005863, 30.2427024],
                    [120.2005863, 30.2427024],
                    [120.2005825, 30.242762],
                    [120.2005825, 30.242762],
                    [120.2005861, 30.2428216],
                    [120.2005861, 30.2428216],
                    [120.2005972, 30.2428804],
                    [120.2005972, 30.2428804],
                    [120.2006156, 30.2429379],
                    [120.2006157, 30.2429379],
                    [120.2006412, 30.2429933],
                    [120.2006412, 30.2429933],
                    [120.2006714, 30.2430432],
                    [120.2006774, 30.2430531],
                    [120.2006774, 30.2430531],
                    [120.2007296, 30.2431171],
                    [120.2007296, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007298, 30.2431172],
                    [120.2007298, 30.2431172],
                    [120.2007768, 30.2430831],
                    [120.2008041, 30.2431115],
                    [120.2008313, 30.24314],
                    [120.2008359, 30.2431447],
                    [120.2008996, 30.2432111],
                    [120.2008389, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432552],
                    [120.2008388, 30.2432552],
                    [120.2008388, 30.2432552],
                    [120.2008747, 30.2432983]
                  ]
                ]
              }
            }
          },
          type: 'fill-extrusion',
          paint: {
            'fill-extrusion-color': 'rgb(255, 0, 0)',
            'fill-extrusion-height': [
              'interpolate',
              ['linear'],
              ['zoom'],
              16,
              0,
              16 + 0.55,
              10.5
            ],
            'fill-extrusion-base': 9,
            'fill-extrusion-opacity': 1
          }
        },
        '15_HOUSE'
      );
      // this.map.addLayer(
      //   {
      //     id: 'testtest1', //15级房屋
      //     source: {
      //       type: 'geojson',
      //       data: {
      //         type: 'Feature',
      //         geometry: {
      //           type: 'Polygon',
      //           coordinates: [
      //             [
      //               [120.2013262, 30.2419559],
      //               [120.2012055, 30.2418149],
      //               [120.2010996, 30.2416905],
      //               [120.2011971, 30.2435432],
      //               [120.2012368, 30.2435906],
      //               [120.2013564, 30.2435203],
      //               [120.2013783, 30.2435042],
      //               [120.2013967, 30.2434853],
      //               [120.2014005, 30.2434797],
      //               [120.2014112, 30.2434641],
      //               [120.2014214, 30.2434414],
      //               [120.201427, 30.2434176],
      //               [120.2014279, 30.2433935],
      //               [120.2014239, 30.2433698],
      //               [120.2014152, 30.2433472],
      //               [120.2014021, 30.2433263],
      //               [120.2013848, 30.2433076],
      //               [120.2013639, 30.2432918],
      //               [120.2013318, 30.2432762],
      //               [120.2013411, 30.2432638],
      //               [120.2013156, 30.2432528],
      //               [120.2012479, 30.2432192],
      //               [120.2011841, 30.2431799],
      //               [120.2011248, 30.2431353],
      //               [120.2011164, 30.2422115],
      //               [120.2011657, 30.2422659],
      //               [120.2012095, 30.2423249],
      //               [120.2012475, 30.2423887],
      //               [120.2012671, 30.2424438],
      //               [120.2012796, 30.2425021],
      //               [120.2012844, 30.2425637],
      //               [120.2012798, 30.2426289],
      //               [120.2012629, 30.2426963],
      //               [120.2012323, 30.2427608],
      //               [120.2011909, 30.2428172],
      //               [120.2011434, 30.2428644],
      //               [120.2011121, 30.2423803],
      //               [120.201181, 30.2423342],
      //               [120.2012512, 30.2422928],
      //               [120.2013233, 30.242256],
      //               [120.2013976, 30.2422237],
      //               [120.2014741, 30.2421962],
      //               [120.2015374, 30.2421776],
      //               [120.2016856, 30.2421329],
      //               [120.2016705, 30.2421006],
      //               [120.2016967, 30.2420924],
      //               [120.2017208, 30.2420805],
      //               [120.201742, 30.2420652],
      //               [120.2017598, 30.2420469],
      //               [120.2017738, 30.2420261],
      //               [120.2017835, 30.2420034],
      //               [120.2017887, 30.2419795],
      //               [120.2017893, 30.241955],
      //               [120.2017852, 30.2419306],
      //               [120.2017766, 30.2419069],
      //               [120.2017636, 30.2418846],
      //               [120.2017543, 30.2418728],
      //               [120.2017439, 30.2418618],
      //               [120.2016428, 30.2417724],
      //               [120.2015948, 30.2418118],
      //               [120.2015836, 30.2418019],
      //               [120.2015005, 30.2417295],
      //               [120.201223, 30.2419517],
      //               [120.2011523, 30.243198],
      //               [120.2011284, 30.2431761],
      //               [120.2011115, 30.2431608],
      //               [120.2010948, 30.2421544],
      //               [120.2011078, 30.2431318],
      //               [120.2011173, 30.2431253],
      //               [120.2011739, 30.2430865],
      //               [120.2012014, 30.2430674],
      //               [120.2012326, 30.2430455],
      //               [120.2012639, 30.2430232],
      //               [120.2013124, 30.2430682],
      //               [120.2014091, 30.2429872],
      //               [120.201464, 30.2429415],
      //               [120.2015125, 30.2428908],
      //               [120.2015541, 30.242836],
      //               [120.2015885, 30.2427778],
      //               [120.2016153, 30.2427169],
      //               [120.2016343, 30.2426541],
      //               [120.2016453, 30.24259],
      //               [120.2016484, 30.2425254],
      //               [120.2016434, 30.242461],
      //               [120.2016304, 30.2423976],
      //               [120.2016097, 30.2423358],
      //               [120.2015815, 30.2422764],
      //               [120.2015483, 30.242223],
      //               [120.2015417, 30.2422125],
      //               [120.2014847, 30.2421442],
      //               [120.2014365, 30.2421775],
      //               [120.2014065, 30.2421472],
      //               [120.2013765, 30.2421172],
      //               [120.2013715, 30.2421122],
      //               [120.2013016, 30.2420431],
      //               [120.2013652, 30.2420002],
      //               [120.2013262, 30.2419559],
      //               [120.2013262, 30.2419559]
      //             ]
      //           ]
      //         }
      //       }
      //     },
      //     type: 'fill-extrusion',
      //     paint: {
      //       'fill-extrusion-color': 'rgb(0, 255, 0)',
      //       'fill-extrusion-height': [
      //         'interpolate',
      //         ['linear'],
      //         ['zoom'],
      //         16,
      //         0,
      //         16 + 0.55,
      //         12
      //       ],
      //       'fill-extrusion-base': 10.5,
      //       'fill-extrusion-opacity': 1
      //     }
      //   },
      //   '15_HOUSE'
      // );
      this.map.on('click', '15_HOUSE', e => {
        console.log(e, e.features[0]);
      });
      this.map.on('click', '15_BUILDING', e => {
        console.log(e, e.features[0]);
      });
    });
  };
}
