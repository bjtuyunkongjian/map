/**
 * @author sl 2019-01-02
 * 底图
 */

import mapboxgl from 'mapbox-gl';
import React, { Component } from 'react';

import MapStyles from './map-styles';
import ZjjdLayer from './jiudian';

export default class MapBoxDemo extends Component {
  componentDidMount = () => this._init();

  componentWillUnmount = () => this.map.remove();

  render() {
    return (
      <div
        style={{ width: '100%', height: '100%' }}
        ref={_el => (this._mapContainer = _el)}
      />
    );
  }

  _init = () => {
    window._MAP_ = this.map = new mapboxgl.Map({
      hash: true,
      container: this._mapContainer,
      style: MapStyles,
      showTileBoundaries: true,
      center: [120.208615, 30.245062],
      zoom: 17,
      pitch: 60,
      // bearing: -13.6,
      minZoom: 8,
      maxZoom: 20,
      localIdeographFontFamily: '黑体'
    });
    this.map.on('style.load', () => {
      // 30.2449/120.209
      this.map.addLayer(ZjjdLayer, '15_HOUSE');
      this.map.addLayer(
        {
          id: 'testtest', //15级房屋
          source: {
            type: 'geojson',
            data: {
              type: 'Feature',
              geometry: {
                type: 'Polygon',
                coordinates: [
                  [
                    [120.2008747, 30.2432983],
                    [120.200987, 30.2434373],
                    [120.2010872, 30.2435613],
                    [120.2010872, 30.2435613],
                    [120.2010872, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2010873, 30.2435613],
                    [120.2011919, 30.2434982],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.2012299, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.20123, 30.2435458],
                    [120.2013434, 30.2434769],
                    [120.2013434, 30.2434769],
                    [120.201364, 30.2434611],
                    [120.201364, 30.2434611],
                    [120.2013813, 30.2434426],
                    [120.2013813, 30.2434426],
                    [120.2013848, 30.2434371],
                    [120.2013948, 30.2434218],
                    [120.2013948, 30.2434218],
                    [120.2014041, 30.2433994],
                    [120.2014041, 30.2433994],
                    [120.201409, 30.2433759],
                    [120.201409, 30.2433759],
                    [120.2014093, 30.2433521],
                    [120.2014093, 30.2433521],
                    [120.2014051, 30.2433285],
                    [120.2014051, 30.2433285],
                    [120.2013963, 30.2433059],
                    [120.2013963, 30.2433059],
                    [120.2013833, 30.2432848],
                    [120.2013833, 30.2432848],
                    [120.2013665, 30.243266],
                    [120.2013665, 30.243266],
                    [120.2013463, 30.2432498],
                    [120.2013463, 30.2432498],
                    [120.2013158, 30.2432337],
                    [120.2013242, 30.2432217],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013243, 30.2432216],
                    [120.2013242, 30.2432216],
                    [120.2013242, 30.2432215],
                    [120.2013242, 30.2432215],
                    [120.2013242, 30.2432215],
                    [120.2012999, 30.2432101],
                    [120.2012361, 30.2431752],
                    [120.2011765, 30.243135],
                    [120.2011219, 30.2430899],
                    [120.2010727, 30.2430402],
                    [120.2010294, 30.2429866],
                    [120.2009925, 30.2429294],
                    [120.2009624, 30.2428694],
                    [120.200949, 30.2428187],
                    [120.2009428, 30.242767],
                    [120.2009438, 30.242715],
                    [120.2009521, 30.2426635],
                    [120.2009675, 30.2426133],
                    [120.2009897, 30.242565],
                    [120.2010186, 30.2425194],
                    [120.2010535, 30.2424772],
                    [120.201109, 30.2424257],
                    [120.2011689, 30.242378],
                    [120.2012328, 30.2423345],
                    [120.2013004, 30.2422953],
                    [120.2013712, 30.2422608],
                    [120.2014448, 30.242231],
                    [120.2015063, 30.2422108],
                    [120.2016513, 30.2421629],
                    [120.2016514, 30.2421629],
                    [120.2016514, 30.2421629],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421628],
                    [120.2016514, 30.2421627],
                    [120.2016377, 30.2421319],
                    [120.2016633, 30.2421233],
                    [120.2016634, 30.2421233],
                    [120.2016871, 30.2421111],
                    [120.2016871, 30.2421111],
                    [120.2017082, 30.2420957],
                    [120.2017083, 30.2420957],
                    [120.2017262, 30.2420774],
                    [120.2017262, 30.2420774],
                    [120.2017403, 30.2420568],
                    [120.2017403, 30.2420568],
                    [120.2017504, 30.2420345],
                    [120.2017504, 30.2420345],
                    [120.2017561, 30.242011],
                    [120.2017561, 30.242011],
                    [120.2017572, 30.2419871],
                    [120.2017572, 30.2419871],
                    [120.2017538, 30.2419633],
                    [120.2017538, 30.2419633],
                    [120.2017458, 30.2419403],
                    [120.2017458, 30.2419403],
                    [120.2017337, 30.2419188],
                    [120.2017337, 30.2419188],
                    [120.2017249, 30.2419074],
                    [120.2017249, 30.2419073],
                    [120.201715, 30.2418967],
                    [120.201715, 30.2418967],
                    [120.2016187, 30.2418108],
                    [120.2016187, 30.2418108],
                    [120.2016187, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2016186, 30.2418108],
                    [120.2015715, 30.2418506],
                    [120.2015609, 30.2418412],
                    [120.2014822, 30.241771],
                    [120.2014822, 30.241771],
                    [120.2014822, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2014821, 30.241771],
                    [120.2012147, 30.2419964],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421443],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010391, 30.2421444],
                    [120.2010612, 30.2421665],
                    [120.2010766, 30.2421819],
                    [120.2010945, 30.2421998],
                    [120.2010801, 30.2422107],
                    [120.2010715, 30.2422172],
                    [120.2010209, 30.2422554],
                    [120.2009965, 30.2422738],
                    [120.200969, 30.2422945],
                    [120.2009415, 30.2423152],
                    [120.2008952, 30.2422693],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008952, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008951, 30.2422692],
                    [120.2008084, 30.2423431],
                    [120.2007582, 30.2423838],
                    [120.2007582, 30.2423839],
                    [120.2007133, 30.242429],
                    [120.2007133, 30.2424291],
                    [120.2006745, 30.2424782],
                    [120.2006745, 30.2424782],
                    [120.200642, 30.2425308],
                    [120.200642, 30.2425308],
                    [120.2006163, 30.2425861],
                    [120.2006162, 30.2425861],
                    [120.2005976, 30.2426436],
                    [120.2005976, 30.2426436],
                    [120.2005863, 30.2427024],
                    [120.2005863, 30.2427024],
                    [120.2005825, 30.242762],
                    [120.2005825, 30.242762],
                    [120.2005861, 30.2428216],
                    [120.2005861, 30.2428216],
                    [120.2005972, 30.2428804],
                    [120.2005972, 30.2428804],
                    [120.2006156, 30.2429379],
                    [120.2006157, 30.2429379],
                    [120.2006412, 30.2429933],
                    [120.2006412, 30.2429933],
                    [120.2006714, 30.2430432],
                    [120.2006774, 30.2430531],
                    [120.2006774, 30.2430531],
                    [120.2007296, 30.2431171],
                    [120.2007296, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007297, 30.2431172],
                    [120.2007298, 30.2431172],
                    [120.2007298, 30.2431172],
                    [120.2007768, 30.2430831],
                    [120.2008041, 30.2431115],
                    [120.2008313, 30.24314],
                    [120.2008359, 30.2431447],
                    [120.2008996, 30.2432111],
                    [120.2008389, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432551],
                    [120.2008388, 30.2432552],
                    [120.2008388, 30.2432552],
                    [120.2008388, 30.2432552],
                    [120.2008747, 30.2432983]
                  ]
                ]
              }
            }
          },
          type: 'fill-extrusion',
          paint: {
            'fill-extrusion-color': 'rgb(255, 0, 0)',
            'fill-extrusion-height': [
              'interpolate',
              ['linear'],
              ['zoom'],
              16,
              0,
              16 + 0.55,
              10.5
            ],
            'fill-extrusion-base': 9,
            'fill-extrusion-opacity': 1
          }
        },
        '15_HOUSE'
      );
      this.map.on('click', '15_HOUSE', e => {
        console.log(e, e.features[0]);
      });
      this.map.on('click', '15_BUILDING', e => {
        console.log(e, e.features[0]);
      });
    });
  };
}
